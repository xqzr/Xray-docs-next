(self.webpackChunkXray_docs_next=self.webpackChunkXray_docs_next||[]).push([[9115],{3200:(l,e,r)=>{"use strict";r.r(e),r.d(e,{data:()=>a});const a={key:"v-38c376c1",path:"/en/development/intro/guide.html",title:"开发规范",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"基本",slug:"基本",children:[{level:3,title:"版本控制",slug:"版本控制",children:[]},{level:3,title:"分支（Branch）",slug:"分支-branch",children:[]},{level:3,title:"发布（Release）",slug:"发布-release",children:[]},{level:3,title:"引用其它项目",slug:"引用其它项目",children:[]}]},{level:2,title:"开发流程",slug:"开发流程",children:[{level:3,title:"写代码之前",slug:"写代码之前",children:[]},{level:3,title:"修改代码",slug:"修改代码",children:[]},{level:3,title:"Pull Request",slug:"pull-request",children:[]},{level:3,title:"对代码的修改",slug:"对代码的修改",children:[]}]},{level:2,title:"Xray 编码规范",slug:"xray-编码规范",children:[{level:3,title:"代码结构",slug:"代码结构",children:[]},{level:3,title:"编码规范",slug:"编码规范",children:[]}]}],filePathRelative:"en/development/intro/guide.md",git:{updatedTime:1622027153e3,contributors:[]}}},5399:(l,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>hl});var a=r(6252);const n=(0,a.uE)('<h1 id="开发规范"><a class="header-anchor" href="#开发规范">#</a> 开发规范</h1><h2 id="基本"><a class="header-anchor" href="#基本">#</a> 基本</h2><h3 id="版本控制"><a class="header-anchor" href="#版本控制">#</a> 版本控制</h3><p>project X 的代码被托管在 github 上:</p>',4),i=(0,a.Uk)("xray 核心 "),t={href:"https://github.com/XTLS/Xray-core",target:"_blank",rel:"noopener noreferrer"},s=(0,a.Uk)("xray-core"),u=(0,a.Uk)("xray-flutter "),o={href:"https://github.com/XTLS/Xray-flutter",target:"_blank",rel:"noopener noreferrer"},h=(0,a.Uk)("xray-flutter"),c=(0,a.Uk)("安装脚本 "),m={href:"https://github.com/XTLS/Xray-install",target:"_blank",rel:"noopener noreferrer"},d=(0,a.Uk)("Xray-install"),p=(0,a.Uk)("数据文件 "),g={href:"https://github.com/XTLS/Xray-rules-dat",target:"_blank",rel:"noopener noreferrer"},W=(0,a.Uk)("Xray-rules-dat"),k=(0,a.Uk)("配置模板 "),b={href:"https://github.com/XTLS/Xray-examples",target:"_blank",rel:"noopener noreferrer"},f=(0,a.Uk)("Xray-examples"),U=(0,a.Uk)("xray 文档 "),y={href:"https://github.com/XTLS/XTLS.github.io",target:"_blank",rel:"noopener noreferrer"},v=(0,a.Uk)("XTLS.github.io"),X=(0,a.Uk)("您可以使用 "),x={href:"https://git-scm.com/",target:"_blank",rel:"noopener noreferrer"},_=(0,a.Uk)("Git"),P=(0,a.Uk)(" 来获取代码."),R=(0,a.Wm)("h3",{id:"分支-branch"},[(0,a.Wm)("a",{class:"header-anchor",href:"#分支-branch"},"#"),(0,a.Uk)(" 分支（Branch）")],-1),T=(0,a.Wm)("p",null,"本项目的主干分支为 main, main 分支也是发布时所使用的代码分支, 因此需要确保 master 在任一时刻都是可编译可使用的。",-1),G=(0,a.Wm)("p",null,"如果需要开发新的功能",-1),E=(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,"请新开分支进行开发, 在开发完成并且经过充分测试后, 合并回主干分支."),(0,a.Wm)("li",null,"新开分支如没有必要再存在时, 可以去除.")],-1),L=(0,a.Wm)("h3",{id:"发布-release"},[(0,a.Wm)("a",{class:"header-anchor",href:"#发布-release"},"#"),(0,a.Uk)(" 发布（Release）")],-1),S=(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Uk)("建立尝鲜版本和稳定版本两个发布通道 "),(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,"临时版本, 主要用于特定情况的测试(比如从分支 build 的), 于 TG 群内/issue 回复等渠道 发布特定版本"),(0,a.Wm)("li",null,"尝鲜版本可以为 daily build , 用于尝鲜和获得即时反馈和再改进."),(0,a.Wm)("li",null,"稳定版本为定时更新(比如周更), 合并稳定的修改并发布.")])])],-1),w=(0,a.Wm)("h3",{id:"引用其它项目"},[(0,a.Wm)("a",{class:"header-anchor",href:"#引用其它项目"},"#"),(0,a.Uk)(" 引用其它项目")],-1),B=(0,a.Uk)("Golang "),q=(0,a.Uk)("产品代码建议使用 Golang 标准库和 "),A={href:"https://pkg.go.dev/search?q=golang.org%2Fx",target:"_blank",rel:"noopener noreferrer"},C=(0,a.Uk)("golang.org/x/"),F=(0,a.Uk)(" 下的库；"),H=(0,a.Wm)("li",null,"如需引用其它项目，请事先创建 issue 讨论；",-1),j=(0,a.Wm)("li",null,[(0,a.Uk)("其它 "),(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,"不违反双方的协议，且对项目有帮助的工具，都可以使用。")])],-1),I=(0,a.uE)('<h2 id="开发流程"><a class="header-anchor" href="#开发流程">#</a> 开发流程</h2><h3 id="写代码之前"><a class="header-anchor" href="#写代码之前">#</a> 写代码之前</h3><p>发现任何问题，或对项目有任何想法，请创建 Issue 讨论以减少重复劳动和消耗在代码上的时间。</p><h3 id="修改代码"><a class="header-anchor" href="#修改代码">#</a> 修改代码</h3>',4),M=(0,a.Uk)("Golang "),z=(0,a.Uk)("请参考 "),D={href:"https://golang.org/doc/effective_go.html",target:"_blank",rel:"noopener noreferrer"},O=(0,a.Uk)("Effective Go"),Y=(0,a.Uk)("；"),$=(0,a.Wm)("li",null,[(0,a.Uk)("每一次 push 之前，请运行："),(0,a.Wm)("code",null,"go fmt ./..."),(0,a.Uk)(" 和 "),(0,a.Wm)("code",null,'go fmt -s -l -e -w $(find . -type f -name "*.go" ! -name "*.pb.go")'),(0,a.Uk)("；")],-1),J=(0,a.Wm)("li",null,[(0,a.Uk)("每一次 push 之前，请确保测试通过："),(0,a.Wm)("code",null,"go test ./..."),(0,a.Uk)("；")],-1),K=(0,a.Wm)("li",null,"提交 pull request 之前，请确保新增代码有超过 70% 的代码覆盖率（code coverage）；",-1),N=(0,a.Wm)("li",null,[(0,a.Uk)("其它 "),(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,"请注意代码的可读性。")])],-1),Q=(0,a.uE)('<h3 id="pull-request"><a class="header-anchor" href="#pull-request">#</a> Pull Request</h3><ul><li>提交 PR 之前，请先运行 <code>git pull https://github.com/xray/xray-core.git</code> 以确保 merge 可顺利进行；</li><li>一个 PR 只做一件事，如有对多个 bug 的修复，请对每一个 bug 提交一个 PR；</li><li>由于 Golang 的特殊需求（Package path），Go 项目的 PR 流程和其它项目有所不同 ,建议流程如下： <ol><li>先 Fork 本项目，创建自己的 <code>github.com/your/Xray-core</code> 仓库；</li><li>克隆自己的 Xray 仓库到本地：<code>git clone https://github.com/your/Xray-core.git</code>；</li><li>基于 <code>main</code> 分支创建新的分支；</li><li>在自行创建的分支上作修改并提交修改(commit)；</li><li>在推送(push)修改完成的分支到自己的仓库前，先切换到 <code>main</code> 分支，运行 <code>git pull https://github.com/v2fly/Xray-core.git</code> 拉取最新的远端代码；</li><li>如果上一步拉取得到了新的远端代码，则切换到之前自己创建的分支，运行 <code>git rebase master</code> 执行分支合并操作。如遇到文件冲突，则需要解决冲突；</li><li>上一步处理完毕后，就可以把自己创建的分支推送到自己的仓库：<code>git push -u origin your-branch</code></li><li>最后，把自己仓库的新推送的分支往 <code>xtls/Xray-core</code> 的 <code>main</code> 分支发 PR 即可；</li><li>请在 PR 的标题和正文中，完整表述此次 PR 解决的问题 / 新增的功能 / 代码所做的修改的用意等；</li><li>耐心等待开发者的回应。</li></ol></li></ul><h3 id="对代码的修改"><a class="header-anchor" href="#对代码的修改">#</a> 对代码的修改</h3><h4 id="功能性问题"><a class="header-anchor" href="#功能性问题">#</a> 功能性问题</h4><p>请提交至少一个测试用例（Test Case）来验证对现有功能的改动。</p><h4 id="性能相关"><a class="header-anchor" href="#性能相关">#</a> 性能相关</h4><p>请提交必要的测试数据来证明现有代码的性能缺陷，或是新增代码的性能提升。</p><h4 id="新功能"><a class="header-anchor" href="#新功能">#</a> 新功能</h4><ul><li>如果新增功能对已有功能不影响，请提供可以开启/关闭的开关（如 flag），并使新功能保持默认关闭的状态；</li><li>大型新功能（比如增加一个新的协议）开发之前，请先提交一个 issue，讨论完毕之后再进行开发。</li></ul><h4 id="其它"><a class="header-anchor" href="#其它">#</a> 其它</h4><p>视具体情况而定。</p><h2 id="xray-编码规范"><a class="header-anchor" href="#xray-编码规范">#</a> Xray 编码规范</h2><p>以下内容适用于 Xray 中的 Golang 代码。</p><h3 id="代码结构"><a class="header-anchor" href="#代码结构">#</a> 代码结构</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Xray-core\n├── app        // 应用模块\n│   ├── router // 路由\n├── common     // 公用代码\n├── proxy      // 通讯协议\n│   ├── blackhole\n│   ├── dokodemo-door\n│   ├── freedom\n│   ├── socks\n│   ├── vmess\n├── transport  // 传输模块\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="编码规范"><a class="header-anchor" href="#编码规范">#</a> 编码规范</h3><p>基本与 Golang 官方所推荐做法一致，有一些例外。写在这里以方便大家熟悉 Golang。</p><h4 id="命名"><a class="header-anchor" href="#命名">#</a> 命名</h4>',18),V=(0,a.Wm)("li",null,[(0,a.Uk)("文件和目录名尽量使用单个英文单词，比如 hello.go； "),(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,"如果实在没办法，则目录使用连接线／文件名使用下划线连接两个（或多个单词），比如 hello-world/hello_again.go；"),(0,a.Wm)("li",null,"测试代码使用 _test.go 结尾；")])],-1),Z=(0,a.Wm)("li",null,[(0,a.Uk)("类型使用 Pascal 命名法，比如 ConnectionHandler； "),(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,"对缩写不强制小写，即 HTML 不必写成 Html；")])],-1),ll=(0,a.Wm)("li",null,"公开成员变量也使用 Pascal 命名法；",-1),el=(0,a.Uk)("私有成员变量使用 "),rl={href:"https://zh.wikipedia.org/wiki/%E9%A7%9D%E5%B3%B0%E5%BC%8F%E5%A4%A7%E5%B0%8F%E5%AF%AB",target:"_blank",rel:"noopener noreferrer"},al=(0,a.Uk)("小驼峰式命名法"),nl=(0,a.Uk)(" ，如 "),il=(0,a.Wm)("code",null,"privateAttribute",-1),tl=(0,a.Uk)(" ；"),sl=(0,a.Wm)("li",null,[(0,a.Uk)("为了方便重构，方法建议全部使用 Pascal 命名法； "),(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Uk)("完全私有的类型放入 "),(0,a.Wm)("code",null,"internal"),(0,a.Uk)(" 。")])])],-1),ul=(0,a.Wm)("h4",{id:"内容组织"},[(0,a.Wm)("a",{class:"header-anchor",href:"#内容组织"},"#"),(0,a.Uk)(" 内容组织")],-1),ol=(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,"一个文件包含一个主要类型，及其相关的私有函数等；"),(0,a.Wm)("li",null,"测试相关的文件，如 Mock 等工具类，放入 testing 子目录。")],-1),hl={render:function(l,e){const r=(0,a.up)("OutboundLink"),hl=(0,a.up)("Badge");return(0,a.wg)(),(0,a.j4)(a.HY,null,[n,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[i,(0,a.Wm)("a",t,[s,(0,a.Wm)(r)])]),(0,a.Wm)("li",null,[u,(0,a.Wm)("a",o,[h,(0,a.Wm)(r)])]),(0,a.Wm)("li",null,[c,(0,a.Wm)("a",m,[d,(0,a.Wm)(r)])]),(0,a.Wm)("li",null,[p,(0,a.Wm)("a",g,[W,(0,a.Wm)(r)])]),(0,a.Wm)("li",null,[k,(0,a.Wm)("a",b,[f,(0,a.Wm)(r)])]),(0,a.Wm)("li",null,[U,(0,a.Wm)("a",y,[v,(0,a.Wm)(r)])])]),(0,a.Wm)("p",null,[X,(0,a.Wm)("a",x,[_,(0,a.Wm)(r)]),P]),R,T,G,E,L,(0,a.Wm)(hl,{text:"WIP",type:"warning"}),S,w,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[B,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[q,(0,a.Wm)("a",A,[C,(0,a.Wm)(r)]),F]),H])]),j]),I,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[M,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[z,(0,a.Wm)("a",D,[O,(0,a.Wm)(r)]),Y]),$,J,K])]),N]),Q,(0,a.Wm)("ul",null,[V,Z,ll,(0,a.Wm)("li",null,[el,(0,a.Wm)("a",rl,[al,(0,a.Wm)(r)]),nl,il,tl]),sl]),ul,ol],64)}}}}]);